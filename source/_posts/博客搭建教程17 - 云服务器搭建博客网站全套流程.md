title: 云服务器搭建博客网站全套流程浓缩版
author: epya15
tags:

  - 博客
categories: []
date: 2024-02-01 16:00:00
img: https://lmg.jj20.com/up/allimg/4k/s/01/2109241124345426-0-lp.jpg
excerpt: '不涉及概念解释，主要记录具体操作，以及写博文全套工具链用法'

---
### 1.配置安全组

租用云服务器，安装centOS 7系统，配置安全组，放开【入方向规则】指定或全部端口以正常安装宝塔运维工具

### 2.安装宝塔

使用在线安装或者键入命令

> yum install -y wget && wget -O install.sh https://download.bt.cn/install/install_6.0.sh && sh install.sh ed8484bec

### 3.安装Nginx

//一键安装全部依赖

> yum -y install gcc zlib zlib-devel pcre-devel opensslopenssl-devel

//创建一个Nginx文件夹

> cd /usr/local
> mkdir nginx
> cd nginx

//下载tar包

> wget http://nginx.org/download/nginx-1.13.7.tar.gz
>
> tar -xvf nginx-1.13.7.tar.gz

//进入nginx目录

> cd /usr/local/nginx

//进入目录（以实际安装版本号为准）

> cd nginx-1.13.7

//执行命令考虑到后续安装ssl证书 添加两个模块

> ./configure --with-http_stub_status_module --with-http_ssl_module

//执行make命令

> make

//执行make install命令

> make install

//nginx安装完毕后，为了今后使用方便，将nginx配置到环境变量
echo 'export PATH=/usr/local/nginx/sbin:$PATH' >> /etc/profile
//并使其生效
source /etc/profile
//接下来直接输入nginx -v,看看环境变量有没有配置成功
nginx -v
编辑nginx.config文件



3.配置防火墙
//在服务器控制台的安全组中创建规则，在【入方向规则】中添加对应的端口

//查看防火墙开启状态
systemctl status firewalld
//开启防火墙，没有任何提示则为开启成功
systemctl start firewalld
//如果要关闭防火墙设置,可能通过systemctl stop firewalld这条指令来关闭该功能,没有任何提示则关闭成功
systemctl stop firewalld
//开启80端口
firewall-cmd --permanent --zone=public --add-port=80/tcp --permanent
//查看80端口是否开启
firewall-cmd --permanent --query-port=80/tcp
//重启防火墙
firewall-cmd --reload

在云服武器上ping 百度看看能不能ping通，在其它电脑上ping云服务器看看能不能ping通

4.云服务器安装git（本地写文->上传github->云服务器拉新git->刷新网站）
yum –y install git
键入git指令验证是否安装成功
创建git用户，先不创建密码
adduser git
检查是否创建成功 cd /home && ls -al
如果显示有git则说明用户创建成功
接下来找一个喜欢的目录，创建一个新的git库，需要你自己起一个喜欢的名字，我起名为cpblog.git，注意.git后缀不要变
git init --bare cpblog.git
此时终端提示你创建了一个空的git库，这就说明操作对了。
新建文件夹作为博客根目录
mkdir cpblog_webroot
chmod 777 cpblog_webroot

使用Git-Hooks同步网站根目录，这里使用的是Git中的“post-receive”，当有Git收发的时候会调用该脚本，自动将最新内容同步到网站根目录中
用下面的指令新建勾子文件
vim cpblog.git/hooks/post-receive
将以下语句写入文件
#!/bin/sh
git –work-tree=/usr/local/cpblog_webroot –git-dir=/root/cpblog.git checkout -f
(注意博客路径和当前用户)
保存并赋予执行权限
chmod +x cpblog.git/hooks/post-receive
sudo chown -R git:git cpblog.git
sudo chown -R git:git cpblog_webroot


生成ssh密钥
ssh-keygen -t ecdsa -b 521 -C 'epya15@gmail.com' -f ~/.ssh/id_ecdsa
连按3次回车
接着提取公钥
cat ~/.ssh/id_ecdsa.pub
将公钥填到github的ssh列表中（具体过程略）
输入
ssh -T git@github.com
提示Successfully即为完成配置
进入www/wwwroot目录，克隆git仓库，本地仓库名为cpblog
git clone git@github.com:oO0OoOo/oO0OoOo.github.io.git cpblog


配置账户免密码登录
创建 ssh 的默认目录
进入 git 账户的主目录
cd /home/git
创建 .ssh 的配置，如果此文件夹已经存在请忽略此步
mkdir .ssh
创建校验公钥的配置文件
进入 .ssh 目录并创建 authorized_keys 文件，此文件存放客户端远程访问的 ssh 的公钥
cd .ssh
touch authorized_keys
cd ..
设置权限
chmod 700 .ssh/
chmod 600 .ssh/authorized_keys


启动网站

修改/usr/local/nginx/conf/nginx.conf
将里面的地址改为cpblog的位置

主要修改的部分

location / {
	root   /www/wwwroot/cpblog-hexo/public;
	index  index.html index.htm;
}

#防盗链设置，只允许cypunberk.cn自己网站访问
location ~*\.(png|jpg|jpeg|gif|mp4){
	root /www/wwwroot/epya15.fun;
	valid_referers none blocked www.epya15.fun epya15.fun;
	if ($invalid_referer) {
		#return 403;    #可以返回403，盗链网页显示的是一个裂开的图
		rewrite ^/ /images/invalid_referer_tip.png break;  #返回一个自己定制的图片
	}
}

//本地电脑环境（Windows电脑，需要装git，nodejs，hexo，不需要nginx）
装nodejs(为避免执行cmd权限不足，最好装到D盘，例如D:\nodejs，且放开这个目录的用户访问权限)
https://nodejs.org/en/
在 nodejs 文件夹中新建两个空文件夹node_cache、node_global，执行
npm config set prefix "D:\nodejs\node_global"
npm config set cache "D:\nodejs\node_cache"
装hexo
npm install -g hexo-cli
配置hexo到环境变量PATH中
D:\nodejs\node_global
D盘新建目录D:\cpblog-hexo
在这个目录下执行Git Bash，执行以下命令
npm install -g hexo-cli
hexo g
hexo s
然后在浏览器输入http://localhost:4000/
看能不能看见网页


云服务器拉新
本地全套hexo工程+hexo环境，服务器全套hexo工程，本地使用hexo g生成网页，直接提交到git上
每次执行本地脚本完成服务器更新

做法：
1.ssh免密登录
将本地电脑的.ssh/id_rsa.pub的内容粘贴至服务器的/root/.ssh/authorized_keys文件中，这个文件可以粘贴多个key，换行即可
2.给shell目录777权限
chmod 777 /www/wwwroot/cpblog-hexo/shell
3.本地写文章D:\cpblog-hexo\source\_posts
4.双击‪D:\cpblog-hexo\shell\deploy.sh执行（全套流程）
5.执行完毕后网页就变更了

Typora + PicGo + github 实现最舒服的图片引用姿势

飞书云文档转markdown
https://feishu2md.onrender.com/